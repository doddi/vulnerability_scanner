package com.doddi.vulnerability_scanner_idea_plugin.system.python;

import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Optional;
import java.util.Set;

import com.doddi.vulnerability_scanner_idea_plugin.entity.LibraryToScan;
import com.doddi.vulnerability_scanner_idea_plugin.entity.VulnerableComponent;
import com.doddi.vulnerability_scanner_idea_plugin.system.Populator;

public class PythonPopulator implements Populator
{
  private final Map<String, VulnerableComponent> components = new HashMap<>();

  @Override
  public void populate(final Set<LibraryToScan> libraries, final List<VulnerableComponent> vulnerableComponents) {
    components.clear();
    vulnerableComponents.forEach(component -> components.put(component.getPackageUrl().toString(), component));
  }

  @Override
  public Map<String, VulnerableComponent> getVulnerableComponents() {
    return components;
  }

  @Override
  public Optional<VulnerableComponent> isVulnerable(final String name) {
    return components.values().stream()
        .filter(vulnerableComponent -> vulnerableComponent.getPackageUrl().getName().equals(name))
        .findFirst();
  }
}
