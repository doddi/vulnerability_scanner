package com.doddi.vulnerability_scanner_idea_plugin.system.npm;

import com.doddi.vulnerability_scanner_idea_plugin.system.ViolationAnnotator;
import com.intellij.json.psi.impl.JsonPropertyImpl;
import com.intellij.lang.annotation.AnnotationHolder;
import com.intellij.psi.PsiElement;
import org.jetbrains.annotations.NotNull;

public class PackageLockViolationAnnotator
    extends ViolationAnnotator
{
  @Override
  public void annotate(@NotNull final PsiElement element, @NotNull final AnnotationHolder holder) {
    if ("package.json".equals(element.getContainingFile().getName())) {
      if (element instanceof JsonPropertyImpl) {
        if (element.getParent().getParent() instanceof JsonPropertyImpl) {
          if ("dependencies".equals(((JsonPropertyImpl) element.getParent().getParent()).getName())) {
            final JsonPropertyImpl jsonProperty = (JsonPropertyImpl) element;
            showIfVulnerable(element.getProject(), holder, element.getTextRange(), jsonProperty.getName());
          }
        }
      }
    }
  }
}
