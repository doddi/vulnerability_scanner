package com.doddi.vulnerability_scanner_idea_plugin.system;

import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Optional;
import java.util.Set;

import com.doddi.vulnerability_scanner_idea_plugin.config.ProjectConfigurationListener;
import com.doddi.vulnerability_scanner_idea_plugin.entity.LibraryToScan;
import com.doddi.vulnerability_scanner_idea_plugin.entity.VulnerableComponent;
import com.intellij.openapi.application.ApplicationManager;

public abstract class Populator
{
  protected final Map<String, VulnerableComponent> components = new HashMap<>();

  public Populator() {
    ApplicationManager.getApplication().getMessageBus().connect()
        .subscribe(ProjectConfigurationListener.TOPIC, new ProjectConfigurationListener()
        {
          /**
           * When configuration changes, re-attach contents.
           */
          @Override
          public void configurationChanged() {
            components.clear();
          }
        });
  }

  public abstract void populate(final Set<LibraryToScan> libraries,
                                final List<VulnerableComponent> vulnerableComponents);

  public abstract Map<String, VulnerableComponent> getVulnerableComponents();

  public abstract Optional<VulnerableComponent> isVulnerable(String name);
}
