package com.doddi.vulnerability_scanner_idea_plugin;

import java.util.List;

import com.doddi.vulnerability_scanner_idea_plugin.entity.VulnerableComponent;

public class VulnerabilityMessageProvider {

    public static String buildToolMessage(String providerName, String provideUrl, List<VulnerableComponent> components) {
        final StringBuffer stringBuffer = new StringBuffer();
        buildTitle(providerName, provideUrl, stringBuffer);

        stringBuffer.append(String.format("\n%d vulnerable %s detected", components.size(), getComponentString(components.size())));
        stringBuffer.append("\n\n<ul>");
        components.forEach( c -> stringBuffer.append(String.format("<li>%s</li>", c.getPackageUrl().toString())));
        stringBuffer.append("</ul>");
        return stringBuffer.toString();
    }

    private static void buildTitle(String providerName, String provideUrl, StringBuffer stringBuffer) {
        stringBuffer.append("Vulnerability information Provided by: ");
        stringBuffer.append(buildLink(providerName, provideUrl));
    }

    private static String getComponentString(int component) {
        return component == 1 ? "component" : "components";
    }

    private static String buildLink(String title, String link) {
        return String.format("<a href=%s>%s</a>", link, title);
    }
}
