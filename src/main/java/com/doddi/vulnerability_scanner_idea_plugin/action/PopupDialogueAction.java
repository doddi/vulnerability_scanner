package com.doddi.vulnerability_scanner_idea_plugin.action;

import java.util.Map;

import com.doddi.vulnerability_scanner_idea_plugin.module.VulnerableComponent;
import com.doddi.vulnerability_scanner_idea_plugin.service.VulnerabilityService;

import com.intellij.openapi.actionSystem.AnAction;
import com.intellij.openapi.actionSystem.AnActionEvent;
import com.intellij.openapi.project.Project;
import com.intellij.openapi.ui.Messages;
import org.jetbrains.annotations.NotNull;

public class PopupDialogueAction extends AnAction
{
  @Override
  public void update(@NotNull final AnActionEvent e) {
    final Project project = e.getProject();
    e.getPresentation().setEnabledAndVisible(project != null);
  }

  @Override
  public void actionPerformed(@NotNull final AnActionEvent event) {
    final VulnerabilityService service = VulnerabilityService.getInstance();
    final Map<String, VulnerableComponent> vulnerableComponents = service.getVulnerableComponents();

    Project currentProject = event.getProject();
    String dlgTitle = event.getPresentation().getDescription();

    StringBuffer dlgMsg = new StringBuffer("Vulnerable Components:\n");
    vulnerableComponents.forEach((k, v) -> dlgMsg.append(v.getPackageUrl()).append("\n"));
    Messages.showMessageDialog(currentProject, dlgMsg.toString(), dlgTitle, Messages.getInformationIcon());
  }
}
