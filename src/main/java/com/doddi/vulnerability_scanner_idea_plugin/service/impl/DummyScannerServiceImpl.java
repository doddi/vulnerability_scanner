package com.doddi.vulnerability_scanner_idea_plugin.service.impl;

import java.net.URI;
import java.util.List;
import java.util.stream.Collectors;

import javax.inject.Named;

import org.sonatype.goodies.packageurl.PackageUrl;
import org.sonatype.ossindex.service.api.componentreport.ComponentReportVulnerability;

import com.doddi.vulnerability_scanner_idea_plugin.entity.VulnerableComponent;
import com.doddi.vulnerability_scanner_idea_plugin.service.ScannerService;
import com.google.common.collect.ImmutableList;
import com.intellij.openapi.project.Project;
import org.jetbrains.annotations.NotNull;

@Named(DummyScannerServiceImpl.NAME)
public class DummyScannerServiceImpl
    implements ScannerService
{
  public static final String NAME = "Dummy";

  @Override
  public List<VulnerableComponent> scan(final Project project,
                                        final List<PackageUrl> componentsToScan) {
    return componentsToScan.stream()
        .map(this::getVulnerableComponent)
        .collect(Collectors.toList());
  }

  @Override
  public String getName() {
    return NAME;
  }

  @Override
  public String getUrl() {
    return "https://www.sonatype.com";
  }

  @NotNull
  private VulnerableComponent getVulnerableComponent(final PackageUrl component) {
    final VulnerableComponent vulnerableComponent = new VulnerableComponent();
    vulnerableComponent.setPackageUrl(component);
    vulnerableComponent.setVulnerabilities(ImmutableList.of(
        createDummyComponentReportVulnerability()
    ));
    return vulnerableComponent;
  }

  @NotNull
  private ComponentReportVulnerability createDummyComponentReportVulnerability() {
    final ComponentReportVulnerability componentReportVulnerability = new ComponentReportVulnerability();
    componentReportVulnerability.setTitle("CVE-000-123");
    componentReportVulnerability.setReference(URI.create("https://www.sonatype.comr"));
    return componentReportVulnerability;
  }
}
