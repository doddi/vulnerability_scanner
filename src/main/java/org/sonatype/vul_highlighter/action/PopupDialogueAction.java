package org.sonatype.vul_highlighter.action;

import java.util.Map;

import org.sonatype.vul_highlighter.module.ScannedComponent;
import org.sonatype.vul_highlighter.service.VulnerabilityService;

import com.intellij.openapi.actionSystem.AnAction;
import com.intellij.openapi.actionSystem.AnActionEvent;
import com.intellij.openapi.components.ServiceManager;
import com.intellij.openapi.project.Project;
import com.intellij.openapi.ui.Messages;
import org.jetbrains.annotations.NotNull;

public class PopupDialogueAction extends AnAction
{
  @Override
  public void update(@NotNull final AnActionEvent e) {
    final Project project = e.getProject();
    e.getPresentation().setEnabledAndVisible(project != null);
  }

  @Override
  public void actionPerformed(@NotNull final AnActionEvent event) {
    final VulnerabilityService service = ServiceManager.getService(VulnerabilityService.class);
    final Map<String, ScannedComponent> vulnerableComponents = service.getVulnerableComponents();

    Project currentProject = event.getProject();
    String dlgTitle = event.getPresentation().getDescription();

    StringBuffer dlgMsg = new StringBuffer("Vulnerable Components:\n");
    vulnerableComponents.forEach((k, v) -> dlgMsg.append(v.getPackageUrl()).append("\n"));
    Messages.showMessageDialog(currentProject, dlgMsg.toString(), dlgTitle, Messages.getInformationIcon());
  }
}
