package org.sonatype.vul_highlighter.listener;

import java.util.List;

import com.intellij.openapi.components.ServiceManager;
import com.intellij.openapi.vfs.newvfs.BulkFileListener;
import com.intellij.openapi.vfs.newvfs.events.VFileEvent;
import org.jetbrains.annotations.NotNull;
import org.jetbrains.idea.maven.model.MavenArtifactNode;
import org.jetbrains.idea.maven.project.MavenProject;
import org.jetbrains.idea.maven.project.MavenProjectsManager;

public class FileChangeListener implements BulkFileListener
{
  @Override
  public void after(@NotNull final List<? extends VFileEvent> events) {

    for (VFileEvent event : events) {
      if (event.getFile().getName().endsWith("pom.xml")) {

        final MavenProjectsManager mavenProjectsManager = ServiceManager.getService(MavenProjectsManager.class);

        final MavenProject project = mavenProjectsManager.findProject(event.getFile());

        //TODO Get list of dependencies
        final List<MavenArtifactNode> dependencyTree = project.getDependencyTree();
        System.out.println(dependencyTree.size());
      }
    }
  }
}
