package com.doddi.vulnerability_scanner_idea_plugin.system.npm.packagelock;

import java.net.URL;

import org.junit.Test;

import static org.hamcrest.CoreMatchers.notNullValue;
import static org.hamcrest.MatcherAssert.assertThat;
import static org.hamcrest.core.Is.is;

public class PackageLockReaderTest
{

  @Test
  public void canReadPackageLock() {
    final URL resource = getClass().getResource("package-lock.json");

    PackageLockReader underTest = new PackageLockReader();

    PackageLock packageLock = underTest.read(resource.getFile());

    assertThat(packageLock.getDependencies().size(), is(49));
    assertDependencyVersion(packageLock, "accepts", "1.3.7");
    assertDependencyVersion(packageLock, "express", "4.17.1");
    assertDependencyVersion(packageLock, "fresh", "0.5.2");
  }

  public void assertDependencyVersion(final PackageLock packageLock, final String express, final String s) {
    assertThat(packageLock.getDependencies().get(express), is(notNullValue()));
    assertThat(packageLock.getDependencies().get(express).getVersion(), is(s));
  }
}